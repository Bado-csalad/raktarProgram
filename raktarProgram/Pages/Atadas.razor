@page "/atadas"
@using Blazorise.Components
@inject IHomeRespitory repo

<h1>Átadás</h1>



<Row>
    <Column ColumnSize="ColumnSize.Is3">
        <Alert Color="Color.Primary" Visible="true">
            Mit:
        </Alert>
    </Column>
    <Column ColumnSize="ColumnSize.Is9">
        <SelectList Data="@xmitLista"
                    TextField="@((item)=>item.Nev)"
                    ValueField="@((item)=>item.ID)"
                    SelectedValueChanged="@selectedEszkozChangedHandler" />
    </Column>
</Row>
<Row>
    <Column ColumnSize="ColumnSize.Is3">
        <Alert Color="Color.Primary" Visible="true">
            Honnan:
        </Alert>
    </Column>
    <Column ColumnSize="ColumnSize.Is9">
        <SelectList Data="@xkitolList"
                    TextField="@((item)=>item.EszkozhelyNev)"
                    ValueField="@((item)=>item.ID)"
                    SelectedValueChanged="@selectedHelyChangedHandler" />
    </Column>
</Row>
<Row>
    <Column ColumnSize="ColumnSize.Is3">
        <Alert Color="Color.Primary" Visible="true">
            Hova:
        </Alert>
    </Column>
    <Column ColumnSize="ColumnSize.Is9">
        <SelectList Data="@xhovaList"
                    TextField="@((item)=>item.Nev)"
                    ValueField="@((item)=>item.ID)"
                    SelectedValueChanged="@selectedHovaChangedHandler" />
    </Column>
</Row>



@code {
    List<Eszkoz> xmitLista = null;
    List<Hely> xkitolList = null;
    List<EszkozHely> xhovaList = null;
    Eszkoz xmit;
    Hely xkitol;
    EszkozHely xhova;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            this.xmitLista = await this.repo.GetXMitList();
            this.xmitLista.Insert(0, new Eszkoz());
            StateHasChanged();
        }
    }

    async Task selectedEszkozChangedHandler(object newEszkoz)
    {
        xmit = this.xmitLista.First(c => c.ID == Convert.ToInt32(newEszkoz));

        this.xkitolList = await this.repo.GetXKitolList(xmit.ID);
        this.xkitolList.Insert(0, new Hely());
        StateHasChanged();
    }

    async Task selectedHelyChangedHandler(object newHely)
    {
        xkitol = this.xkitolList.First(c => c.ID == Convert.ToInt32(newHely));

        this.xhovaList = await this.repo.GetXHovaList(xkitol.EszkozHelyID);
        this.xhovaList.Insert(0, new EszkozHely());
        StateHasChanged();
    }

    async Task selectedHovaChangedHandler(object newHova)
    {
        xhova = this.xhovaList.First(c => c.ID == Convert.ToInt32(newHova));
        StateHasChanged();
    }
}
